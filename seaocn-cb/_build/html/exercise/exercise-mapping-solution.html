

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Exercise 2 Time series &#8212; seaocn</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'exercise/exercise-mapping-solution';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="seaocn - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="seaocn - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    MSc Seagoing Oceanography
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview/catalog-listing.html">Course catalog listing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/syllabus.html">Syllabus (SuSe24)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/schedule.html">Schedule (SuSe24)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../topics/course_overview.html">1. Course overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/scientific_basis.html">2. Scientific basis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="exercise-git.html">Exercise 0a - Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise-python.html">Exercise 0b - Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise-cnv.html">Exercise 1 - Profile data</a></li>



<li class="toctree-l1"><a class="reference internal" href="exercise-tseries.html">Exercise 2  Time series</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise-filter.html">Exercise 2<span class="math notranslate nohighlight">\(^+\)</span>  Filtering</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../resource/git.html">Git for sharing &amp; versioning</a></li>

<li class="toctree-l1"><a class="reference internal" href="../resource/python.html">Python</a></li>

<li class="toctree-l1"><a class="reference internal" href="../resource/books.html">Books + Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource/glossary.html">Glossary</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../build-the-book/getting-started.html">Setting up a jupyter book</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../build-the-book/jupyter-book.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build-the-book/github-pages.html">Prepare the git repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build-the-book/use-of-tokens.html">Use of tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build-the-book/regenerating-book.html">Regenerating the book after changes</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ifmeo-hamburg/seaocn" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ifmeo-hamburg/seaocn/issues/new?title=Issue%20on%20page%20%2Fexercise/exercise-mapping-solution.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/exercise/exercise-mapping-solution.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exercise 2  Time series</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Exercise 2  Time series</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-notebook-load-the-data">Create a notebook &amp; load the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-some-data">Download some data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-data">Load the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#errors-with-time-format">Errors with time format</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fig-1-plot-the-time-series">Fig 1. Plot the time series</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#errors">Errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixing-dimensionality">Fixing dimensionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#re-try-your-plotting">Re-try your plotting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explore-the-data">Explore the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fig-2-plot-an-annual-cycle">Fig 2. Plot an annual cycle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-a-trend-updating-fig-1">Fitting a trend - updating Fig. 1</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-and-spectra">Filtering and spectra</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-a-one-year-time-period">Select a one year time period</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="exercise-2-time-series">
<h1>Exercise 2  Time series<a class="headerlink" href="#exercise-2-time-series" title="Permalink to this heading">#</a></h1>
<p><strong>Aim:</strong> The purpose of this lab is to get you started with elementary time series analysis: fitting a trend and a polynomial to a time series.</p>
<p><strong>Learning outcomes:</strong> At the end of this lab, you will be able to:</p>
<ol class="arabic simple">
<li><p>Calculate a linear trend given a time series, and determine its slope and y-offset.</p></li>
<li><p>Calculate a polynomial fit to the time series, and determine the acceleration.</p></li>
<li><p>Gain basic familiarity with Python <code class="docutils literal notranslate"><span class="pre">xarray</span></code> data arrays, and familiarity with indices and NaNs.</p></li>
</ol>
<!--4. Use the functions including: nanmean, detrend, polyfit, polyval, disp, grid, find, isnan, sqrt, and the operators ==, ~ and .^2.-->
<p><strong>Data:</strong> You will work with a time series of monthly sea surface temperature.</p>
<p><strong>Directions:</strong> Answer the questions, create an <code class="docutils literal notranslate"><span class="pre">*.ipynb</span></code> and one figure.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Xarray docs: <a class="reference external" href="https://docs.xarray.dev/en/latest/user-guide/time-series.html">https://docs.xarray.dev/en/latest/user-guide/time-series.html</a></p>
</div>
<hr><section id="create-a-notebook-load-the-data">
<h2>Create a notebook &amp; load the data<a class="headerlink" href="#create-a-notebook-load-the-data" title="Permalink to this heading">#</a></h2>
<ol class="arabic">
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">*.ipynb</span></code> containing the commands for this assignment, or copy this file.</p>
<div class="admonition-file-naming-convention admonition">
<p class="admonition-title">File naming convention</p>
<p>Name your python notebook something useful <code class="docutils literal notranslate"><span class="pre">ex&lt;X&gt;-&lt;Lastname&gt;-&lt;slug&gt;-seaocn.ipynb</span></code> where you replace <code class="docutils literal notranslate"><span class="pre">&lt;X&gt;</span></code> with the exercise number and <code class="docutils literal notranslate"><span class="pre">&lt;slug&gt;</span></code> with the short slug to name the topic, and <code class="docutils literal notranslate"><span class="pre">&lt;Lastname&gt;</span></code> with your last name.</p>
<p>Figures should be named something like <code class="docutils literal notranslate"><span class="pre">ex&lt;X&gt;fig&lt;Y&gt;-&lt;Lastname&gt;-&lt;slug&gt;-seaocn.png</span></code> where you replace <code class="docutils literal notranslate"><span class="pre">&lt;X&gt;</span></code> with the exercise number, <code class="docutils literal notranslate"><span class="pre">&lt;Y&gt;</span></code> with the figure number, and <code class="docutils literal notranslate"><span class="pre">&lt;Lastname&gt;</span></code> with your last name.</p>
</div>
</li>
<li><p>Import necessary packages.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">xarray</span></code>.  You may also need</p>
<p>If you are missing any of these packages, please refer to <a class="reference internal" href="../resource/python.html"><span class="doc std std-doc">Resources: Python</span></a>.</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing required packages here</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">6.5</span><span class="p">)</span> <span class="c1">#set default figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;serif&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="download-some-data">
<h3>Download some data<a class="headerlink" href="#download-some-data" title="Permalink to this heading">#</a></h3>
<p>Go to the <a class="reference external" href="https://climexp.knmi.nl/start.cgi">KNMI climate explorer</a> and download a time series of monthly sea surface temperature since 1850.</p>
<ol class="arabic simple">
<li><p>Click “Monthly Observations” on the right</p></li>
<li><p>Choose temperature from “Berkeley 1 deg”</p></li>
<li><p>Select a latitude and longitude in the ocean. Enter a range into the latitude which is 1 degree wide.  Note that for the southern hemisphere, you should use negative values.  For degrees west you should use “negative degrees east”.</p></li>
<li><p>After entering values in the 2 latititude and 2 longitude boxes, click the choice “subset of the field” after make.</p></li>
<li><p>Click the button “Make time series”.</p></li>
<li><p>Scroll to the bottom of the page, and find the line “If you <em>really</em> want to get it here, <data file name> is available as a netcdf file.  Click the link with “netcdf file” to download your data.</p></li>
<li><p>Put the data into the <code class="docutils literal notranslate"><span class="pre">data/</span></code> folder on your computer.  This should be accessible from the location of your python exercises.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;../data/&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;HadCRUT.4.6.0.0.median_-35--34E_60-61N_su.nc&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;TAVG_landocean_LatLong1_-51--50E_30-31N.nc&#39;</span>

<span class="c1"># To concatenate two strings in python, you use the &#39;+&#39; symbol</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">filename</span>
<span class="c1"># Try a `print` on your new variable to see what it is</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>../data/TAVG_landocean_LatLong1_-51--50E_30-31N.nc
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-the-data">
<h3>Load the data<a class="headerlink" href="#load-the-data" title="Permalink to this heading">#</a></h3>
<p>The data are in a netCDF file.  As before, we will use <code class="docutils literal notranslate"><span class="pre">xarray</span></code> to handle the dataset.  Make sure you have included <code class="docutils literal notranslate"><span class="pre">xarray</span></code> in your cell above importing packages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading the data</span>
<span class="c1">#  --&gt; Uncomment this line.  Note that it will throw an error.  After troubleshooting the error, you can comment it back out again.</span>
<span class="c1">#sst1 = xr.open_dataset(fname)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="errors-with-time-format">
<h3>Errors with time format<a class="headerlink" href="#errors-with-time-format" title="Permalink to this heading">#</a></h3>
<p>One of the things that can cause a headache in python is time formatting, and we see this here.</p>
<p>Depending on your installation, <code class="docutils literal notranslate"><span class="pre">xarray</span></code> cannot decode the time format which, from the error message, we see is in units of “months since 1850-01-01”.  The error message itself recommends a (temporary) fix by using <code class="docutils literal notranslate"><span class="pre">decode_times=False</span></code>.</p>
<ol class="arabic simple">
<li><p>Try loading the data using this hint.</p></li>
<li><p>Note the format of the time - it’s now integers counting from 0 to 2077, which doesn’t look like “time”</p></li>
<li><p>Create a time vector representing the time (you may need to refer back to your error message above to see what the time should be).</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading the data - with &#39;decode_times=False&#39;</span>
<span class="n">sst1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sst1</span><span class="p">)</span>
<span class="c1"># sst1.time runs from 0 = January 1850 to 2063 = </span>

<span class="n">amo</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">file_path</span> <span class="o">+</span> <span class="s1">&#39;iamo_ersst_ts.nc&#39;</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># &#39;months since 1854-01-15</span>
<span class="nb">print</span><span class="p">(</span><span class="n">amo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:      (time: 2078, lon: 1, lat: 1)
Coordinates:
  * time         (time) float32 0.0 1.0 2.0 ... 2.075e+03 2.076e+03 2.077e+03
  * lon          (lon) float32 -50.5
  * lat          (lat) float32 30.5
Data variables:
    temperature  (time, lat, lon) float32 ...
Attributes: (12/24)
    title:                      subset of Native Format Berkeley Earth Surfac...
    Conventions:                CF-1.0
    source_field:               https://climexp.knmi.nl/select.cgi?field=berk...
    cdi:                        Climate Data Interface version 2.0.5 (https:/...
    institution:                KNMI Climate Explorer and Berkeley Earth Surf...
    land_source_history:        05-Mar-2023 08:24:35
    ...                         ...
    geospatial_lon_resolution:  1.0
    time_coverage_start:        1850-01-15
    time_coverage_end:          2023-02-15
    climexp_url:                https://climexp.knmi.nl/select.cgi?berkeley_l...
    scripturl01:                http://climexp.knmi.nl/get_index.cgi?email=so...
    history:                     2024-04-07 19:36:25 ./bin/get_index Berkeley...
&lt;xarray.Dataset&gt;
Dimensions:  (time: 2052)
Coordinates:
  * time     (time) float32 0.0 1.0 2.0 3.0 ... 2.049e+03 2.05e+03 2.051e+03
Data variables:
    AMO      (time) float32 ...
Attributes: (12/48)
    title:                      Difference between ersst_0-60N_0-80W.dat and ...
    description:                AMO ersst
    scripturl01:                http://climexp.knmi.nl/getindices.cgi?STATION...
    file:                       ersst_0-60N_0-80W.dat
    olderfile:                  ersstv5.nc
    oldertitle:                 spatial statistic of NOAA ERSSTv5 (in situ only)
    ...                         ...
    series2_ave_region:         lon=   -1.000  359.000, lat=  -61.000   61.000
    series2_history:            user sager 2024-03-25 22:13:31 /nobackup_1/us...
    file2:                      ersst_60S-60N.dat
    scripturl02:                http://climexp.knmi.nl/dat2nc.cgi?id=someone@...
    history:                     2024-04-08 18:16:49 ./bin/dat2nc data/iamo_e...
    Conventions:                CF-1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a time vector</span>
<span class="n">funnytime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1850-01-01&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sst1</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>

<span class="c1"># Now replace these values in the time vector for the xarray object</span>
<span class="n">sst1</span> <span class="o">=</span> <span class="n">sst1</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">funnytime</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>

<span class="n">sst1</span> <span class="o">=</span> <span class="n">sst1</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">temp2</span><span class="o">=</span><span class="n">sst1</span><span class="o">.</span><span class="n">temperature</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">MM</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">amo</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1855-01-01&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">MM</span><span class="p">)</span>
<span class="c1">#+ pd.DateOffset(1)</span>
<span class="n">amo</span> <span class="o">=</span> <span class="n">amo</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sst1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:      (time: 2078, lon: 1, lat: 1)
Coordinates:
  * time         (time) datetime64[ns] 1850-01-01 1850-02-01 ... 2023-02-01
  * lon          (lon) float32 -50.5
  * lat          (lat) float32 30.5
Data variables:
    temperature  (time, lat, lon) float32 -0.01426 -1.079 ... 0.9417 1.106
    temp2        (time, lat, lon) float32 -2.014 -3.079 ... -1.058 -0.8941
Attributes: (12/24)
    title:                      subset of Native Format Berkeley Earth Surfac...
    Conventions:                CF-1.0
    source_field:               https://climexp.knmi.nl/select.cgi?field=berk...
    cdi:                        Climate Data Interface version 2.0.5 (https:/...
    institution:                KNMI Climate Explorer and Berkeley Earth Surf...
    land_source_history:        05-Mar-2023 08:24:35
    ...                         ...
    geospatial_lon_resolution:  1.0
    time_coverage_start:        1850-01-15
    time_coverage_end:          2023-02-15
    climexp_url:                https://climexp.knmi.nl/select.cgi?berkeley_l...
    scripturl01:                http://climexp.knmi.nl/get_index.cgi?email=so...
    history:                     2024-04-07 19:36:25 ./bin/get_index Berkeley...
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="fig-1-plot-the-time-series">
<h2>Fig 1. Plot the time series<a class="headerlink" href="#fig-1-plot-the-time-series" title="Permalink to this heading">#</a></h2>
<p>Plot your sea surface temperature against time.</p>
<p>A simple tutorial from <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> for making a plot: <a class="reference external" href="https://matplotlib.org/stable/tutorials/pyplot.html#sphx-glr-tutorials-pyplot-py">https://matplotlib.org/stable/tutorials/pyplot.html#sphx-glr-tutorials-pyplot-py</a></p>
<p>Replot the time series.  Try adding a grid using <code class="docutils literal notranslate"><span class="pre">plt.grid()</span></code>.  Now try adding only horizontal grid lines.  Try reformating the x-axis labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Making a time series plot</span>
<span class="c1"># --&gt; The following line will throw an error.  Try to troubleshoot the error.</span>

<span class="c1"># plt.plot(sst1.time, sst1.temperature, linewidth=2.0)</span>
</pre></div>
</div>
</div>
</div>
<p>The above code should generate an error for you, i.e. python says it can’t compute what you’ve asked it to for some reason.  The last line of the error may look something like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ValueError: x and y can be no greater than 2D, but have shapes (2078,) and (2078, 1, 1)
</pre></div>
</div>
<section id="errors">
<h3>Errors<a class="headerlink" href="#errors" title="Permalink to this heading">#</a></h3>
<p>Try reading the error message you got from the previous line.  It is trying to tell you that there is a problem with plotting your data variable <code class="docutils literal notranslate"><span class="pre">temperature</span></code> because it is 3-dimensional (in this case, its “shape” is (2064,1,1) meaning that the number of rows is 2064, the number of columns is 1 and the number of elements in the 3rd dimension is also 1.</p>
<p>As humans, we might see this as 1-dimensional, but python has a problem with it.</p>
</section>
<section id="fixing-dimensionality">
<h3>Fixing dimensionality<a class="headerlink" href="#fixing-dimensionality" title="Permalink to this heading">#</a></h3>
<p>There are two ways to deal with this problem.</p>
<ol class="arabic">
<li><p>Since the time series is really something like 2078 long, and the 2nd and 3rd dimensions are not needed, we can do this by using the indexing</p>
<p><code class="docutils literal notranslate"><span class="pre">tanom</span> <span class="pre">=</span> <span class="pre">sst1.temperature[:,0,0]</span></code></p>
<p>This says we want all the data from the variable “temperature” in the first dimension (“all” is given by the colon “:” by itself, and the first element in the second dimension (given by 0) and the first element in the third dimension (given by the second zero).  <em>Note: in python, indexing (referring to a location in a vector or matrix) starts counting at zero, so the first element in a sequence has an index of 0, the second element has an index of 1, and so on.</em></p>
</li>
<li><p>An alternative option using <code class="docutils literal notranslate"><span class="pre">xarray</span></code> functionality:  In the case of our sea surface tempearture dataset, since we’ve chosen a 1x1 degree region, the latitude and longitude dimensions are singular (length 1), and the only dimension we want to retain (the “time” dimension) is length 2064, we can use a funny little function for <code class="docutils literal notranslate"><span class="pre">xarray</span></code> called:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
<p>This will take our dataset and squeeze out (remove) the extra dimensions.</p>
<p>Try both of these options, and then use the <code class="docutils literal notranslate"><span class="pre">print</span></code> commands to see what resulted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify how large your temperature variable is (how long in each dimension)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sst1</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Directly index the parts we need</span>
<span class="n">tanom</span> <span class="o">=</span> <span class="n">sst1</span><span class="o">.</span><span class="n">temperature</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Option 1: ----&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tanom</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Option 2: ----&#39;</span><span class="p">)</span>
<span class="c1"># Use xarray &quot;squeeze&quot;</span>
<span class="n">sst_squeeze</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">sst1</span><span class="p">);</span>
<span class="n">sst_squeeze</span> <span class="o">=</span> <span class="n">sst1</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sst_squeeze</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2078, 1, 1)
---- Option 1: ----
&lt;xarray.DataArray &#39;temperature&#39; (time: 2078)&gt;
array([-0.014259, -1.079289, -0.972797, ...,  0.855883,  0.941705,  1.105853],
      dtype=float32)
Coordinates:
  * time     (time) datetime64[ns] 1850-01-01 1850-02-01 ... 2023-02-01
    lon      float32 -50.5
    lat      float32 30.5
Attributes:
    long_name:      Air Surface Temperature Anomaly
    standard_name:  surface_temperature_anomaly
    units:          degree C
---- Option 2: ----
&lt;xarray.Dataset&gt;
Dimensions:      (time: 2078)
Coordinates:
  * time         (time) datetime64[ns] 1850-01-01 1850-02-01 ... 2023-02-01
    lon          float32 -50.5
    lat          float32 30.5
Data variables:
    temperature  (time) float32 -0.01426 -1.079 -0.9728 ... 0.8559 0.9417 1.106
    temp2        (time) float32 -2.014 -3.079 -2.973 ... -1.144 -1.058 -0.8941
Attributes: (12/24)
    title:                      subset of Native Format Berkeley Earth Surfac...
    Conventions:                CF-1.0
    source_field:               https://climexp.knmi.nl/select.cgi?field=berk...
    cdi:                        Climate Data Interface version 2.0.5 (https:/...
    institution:                KNMI Climate Explorer and Berkeley Earth Surf...
    land_source_history:        05-Mar-2023 08:24:35
    ...                         ...
    geospatial_lon_resolution:  1.0
    time_coverage_start:        1850-01-15
    time_coverage_end:          2023-02-15
    climexp_url:                https://climexp.knmi.nl/select.cgi?berkeley_l...
    scripturl01:                http://climexp.knmi.nl/get_index.cgi?email=so...
    history:                     2024-04-07 19:36:25 ./bin/get_index Berkeley...
</pre></div>
</div>
</div>
</div>
</section>
<section id="re-try-your-plotting">
<h3>Re-try your plotting<a class="headerlink" href="#re-try-your-plotting" title="Permalink to this heading">#</a></h3>
<p>Note that if this still doesn’t work, it is possible that your data are not actually 1-dimensional.  You can see this if you check the “shape” of your data. When choosing a dataset to download from KNMI climate explorer, verify that the longitude and latitude ranges were each only 1 degree wide.  Check the size of your data variable again:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(sst1.temperature.shape)
</pre></div>
</div>
<p>The first number in brackets can be <span class="math notranslate nohighlight">\(&gt;1\)</span> but the other two should be <span class="math notranslate nohighlight">\(=1\)</span>.  If the second or third dimensions are <span class="math notranslate nohighlight">\(&gt;1\)</span>, then this is probably where you asked KNMI climate explorer for SSTs in a region that was larger than 1 degree latitude or 1 degree longitude.  Go back and redownload your data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retry your plot with the 1-dimensional temperature vector</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1985</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="c1">#ax.set_xlim(xlim)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">amo</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">amo</span><span class="o">.</span><span class="n">AMO</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x15eed69a0&gt;]
</pre></div>
</div>
<img alt="../_images/7fcd522e03638d0a68267ed58d2fc28572ee0d52fd5ce1bca92eb64ce22dd9ef.png" src="../_images/7fcd522e03638d0a68267ed58d2fc28572ee0d52fd5ce1bca92eb64ce22dd9ef.png" />
</div>
</div>
</section>
</section>
<section id="explore-the-data">
<h2>Explore the data<a class="headerlink" href="#explore-the-data" title="Permalink to this heading">#</a></h2>
<ol class="arabic">
<li><p>What is the mean of the data?</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.xarray.dev/en/stable/user-guide/computation.html">xarray: Computation</a></p>
</div>
</li>
<li><p>What is the first temperature? the minumum temperature?</p></li>
<li><p>What is the last temperature value?  the maximum temperature?</p></li>
<li><p>How many years long is the record?</p></li>
<li><p>How quickly is SST rising? <em>Calculate this using your first, last and time span of the data.</em></p></li>
<li><p>What is the average SST in the last year of the dataset?  In the first year? Re-estimate how quickly SST is rising using these annually averaged values.</p></li>
</ol>
<p><strong>Experiment with printing your answer to the screen.</strong></p>
<p>or</p>
<p>Recall what the ‘+’ does between two strings.  (We saw this above when we were working with the file path and name.)</p>
<ol class="arabic simple" start="7">
<li><p>Now note that your numbers previously calculated had a lot of significant digits.  Suppose the temperature dataset is only accurate to 0.01 deg C.  Use the <code class="docutils literal notranslate"><span class="pre">.round()</span></code> function to round everything to 2 digits past the decimal place.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When should you bundle the whole string of commands together, and when should you break it into steps?  There are a few considerations here.</p>
<ol class="arabic simple">
<li><p>Will I use a computed value again?  If so, then you probably want to save it as something (as in the example of computing tmean and then printing its values.</p></li>
<li><p>Which option is better for readability?  If the computation is long and complex, it may be hard to keep track of what is happening where and when, which can often lead to errors.  In this case, separating it out is also useful.</p></li>
<li><p>If you only need it once, and the calculation is fairly straightforward (like here, the calculation of the mean or median, and only for display purposes) then your code will overall be more compact if you put it in the same line as the print command.</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean and median</span>
<span class="n">tmean</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">tmed</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">tfirst</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">tmax</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">tlast</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">tmin</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mean is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmean</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The mean is 0.09°C.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculating the time difference between the end and beginning</span>
<span class="c1"># You may need the time delta idea.</span>
<span class="c1"># See https://numpy.org/doc/stable/reference/arrays.datetime.html</span>

<span class="c1"># What are the units of range_time?</span>
<span class="n">range_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="c1"># Convert to the number of days</span>
<span class="n">range_days</span> <span class="o">=</span> <span class="n">range_time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[D]&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">range_days</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; days between the end and start&#39;</span><span class="p">)</span>

<span class="n">range_years</span> <span class="o">=</span> <span class="n">range_days</span><span class="o">/</span><span class="mf">365.25</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">range_years</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; years between the end and start&#39;</span><span class="p">)</span>


<span class="c1"># But the question asks you for the range in years - so look at the documentation to see how to do this in years instead of days</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 63218.0 days between the end and start
There are 173.0 years between the end and start
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst1st</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;1850-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;1851-01-01&quot;</span><span class="p">))]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mean in the first year is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sst1st</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mean in the last year is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;2022-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-01-01&quot;</span><span class="p">))]</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The mean in the first year is -0.52737033°C.
The mean in the last year is 1.0382488°C.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a histogram of the first year&#39;s sst</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">mu</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">variance</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="n">NN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>

<span class="c1"># Plot a gaussian</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">norm_curve</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm_curve</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="c1">#plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1607feac0&gt;]
</pre></div>
</div>
<img alt="../_images/ad2762b27febaa3831bdf27bb9e4e5c33f175bfca08bf414542ef37882263d17.png" src="../_images/ad2762b27febaa3831bdf27bb9e4e5c33f175bfca08bf414542ef37882263d17.png" />
</div>
</div>
</section>
<section id="fig-2-plot-an-annual-cycle">
<h2>Fig 2. Plot an annual cycle<a class="headerlink" href="#fig-2-plot-an-annual-cycle" title="Permalink to this heading">#</a></h2>
<ol class="arabic">
<li><p>Extract the January data from the time series.  See how in <a class="reference external" href="https://docs.xarray.dev/en/stable/user-guide/time-series.html">xarray: Time series data</a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>If you’d like a more complete explanation, see this tutorial for xarray: <a class="reference external" href="https://docs.xarray.dev/en/stable/examples/monthly-means.html">https://docs.xarray.dev/en/stable/examples/monthly-means.html</a></p>
</div>
</li>
<li><p>Calculate the mean for January</p></li>
<li><p>Plot the seasonal cycle, calculated as monthly averages, in a new figure.  Add appropriate annotations.  Save this figure as <code class="docutils literal notranslate"><span class="pre">ex&lt;X&gt;fig&lt;Y&gt;_&lt;Lastname&gt;-seaocn.png</span></code>.</p></li>
<li><p>Next step: Estimate a standard error (SE) for the mean of each monthly value, where the standard error is</p>
<div class="math notranslate nohighlight">
\[SE = \frac{\sigma}{\sqrt{N}}\]</div>
<p>with <span class="math notranslate nohighlight">\(\sigma\)</span> the standard deviation and <span class="math notranslate nohighlight">\(N\)</span> the number of values.  A quick-and-dirty estimate would have, for January, that <span class="math notranslate nohighlight">\(\sigma\)</span> is the standard deviation of January values, and <span class="math notranslate nohighlight">\(N\)</span> the number of years of measurements.  This is fine for a first estimate.  However, notice from your earlier time series plot that there are some gaps in the data record , especially prior to 1920.  So this means that the number of years is not equal to 2063 (length of the time series) divided by 12 months.  <em>Recall that the standard error calculation assumes a few things: that your measurements are independent (this is not quite true here) and that your data are normally distributed.  Check your histogram above to see whether the data are normal.</em></p>
<p>Then try plotting the annual cycle and add shading around the time series to indicate the standard error.</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.fill_between</span></code> command.  Experiment with the optional argument <code class="docutils literal notranslate"><span class="pre">alpha</span></code>.  Try giving <code class="docutils literal notranslate"><span class="pre">alpha=.8</span></code> or <code class="docutils literal notranslate"><span class="pre">alpha=.3</span></code>.</p>
</li>
<li><p>Export this figure as figure 2, using the file naming convention.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate an annual cycle</span>
<span class="n">sst_ann</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sst_ann</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sst_ann</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>

<span class="n">numyears</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sst_squeeze</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span>
<span class="n">sst_std_ann</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sst_ann</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sst_ann</span><span class="o">.</span><span class="n">temperature</span> <span class="o">-</span> <span class="n">sst_std_ann</span><span class="o">.</span><span class="n">temperature</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numyears</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sst_ann</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sst_ann</span><span class="o">.</span><span class="n">temperature</span> <span class="o">+</span> <span class="n">sst_std_ann</span><span class="o">.</span><span class="n">temperature</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numyears</span><span class="p">))</span>

<span class="n">upper_lim</span> <span class="o">=</span> <span class="n">sst_ann</span><span class="o">.</span><span class="n">temperature</span> <span class="o">+</span> <span class="n">sst_std_ann</span><span class="o">.</span><span class="n">temperature</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numyears</span><span class="p">)</span>
<span class="n">lower_lim</span> <span class="o">=</span> <span class="n">sst_ann</span><span class="o">.</span><span class="n">temperature</span> <span class="o">-</span> <span class="n">sst_std_ann</span><span class="o">.</span><span class="n">temperature</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numyears</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">sst_ann</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">upper_lim</span><span class="p">,</span> <span class="n">lower_lim</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PolyCollection at 0x161d6deb0&gt;
</pre></div>
</div>
<img alt="../_images/4ef0259e52b009b8be6c64595fd905387dd1eb807d462bff5f1cc09003f43a6c.png" src="../_images/4ef0259e52b009b8be6c64595fd905387dd1eb807d462bff5f1cc09003f43a6c.png" />
</div>
</div>
</section>
<section id="fitting-a-trend-updating-fig-1">
<h2>Fitting a trend - updating Fig. 1<a class="headerlink" href="#fitting-a-trend-updating-fig-1" title="Permalink to this heading">#</a></h2>
<p>Find a line of best fit to the original data.</p>
<ol class="arabic">
<li><p>Fit a first degree polynomial (linear regression).  Recall that a 1st order polynomial has the form</p>
<div class="math notranslate nohighlight">
\[Ax + B\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is the slope.  Read how to use the function <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.polyfit.html">xarray.Dataset.polyfit</a>.  You should use the time dimension as your coordinate along which to fit the 1st degree polynomial (a line).</p>
</li>
<li><p>What is the slope of the line?  What are the units on the slope?</p></li>
<li><p>Convert this to units of degrees/year.</p></li>
</ol>
<p><em>Question for thought:</em> How does this compare to the slope you calculated above when looking at the maximum and minimum of the time series, and time series length?</p>
<ol class="arabic" start="4">
<li><p>Using your linear regression, what temperature would you predict in 1960?  Use the function <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.polyval.html#xarray.polyval">xarray.polyval</a> to compute this.</p></li>
<li><p>What was the observed value in 1960?  Use <code class="docutils literal notranslate"><span class="pre">xarray</span></code> functions to extract the year of 1960 and calculate an average over that year.</p></li>
<li><p>Add the line of best fit to your original plot of the full dataset (or replot here).</p></li>
<li><p>Now fit a polynomial of degree 2 (a quadratic).  A second degree polynomial has the form</p>
<div class="math notranslate nohighlight">
\[Ax^2 + Bx + C\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is the acceleration.  What are the units on <span class="math notranslate nohighlight">\(A\)</span>?</p>
</li>
<li><p>Add this polynomial as a third curve on your plot.</p></li>
<li><p><strong>Clean up the plot.</strong>  This means, add a legend, axes labels, fix the time axis annotations if needed, and fix the fontsize to be legible even if the figure is small.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In future exercises, you will be expected to clean up all plots without reminders.  All plots should have axes labelled (with units!), legible font size (bigger than you think) and appropriate axis ranges.  Legends should be used whenever more than one quantity is plotted.</p>
</div>
<ol class="arabic simple" start="10">
<li><p>Save the figure as a new version of your figure 1, <em>overwriting</em> the previous version.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitting a trend </span>
<span class="n">sst_year</span> <span class="o">=</span> <span class="n">sst_squeeze</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sst_year</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sst_year</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>

<span class="c1"># Dataset.polyfit(dim, deg, skipna=None, rcond=None, w=None, full=False, cov=False)</span>
<span class="n">pf</span> <span class="o">=</span> <span class="n">sst_year</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span>

<span class="n">poly1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">sst_year</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">pf</span><span class="o">.</span><span class="n">temperature_polyfit_coefficients</span><span class="p">,</span> <span class="n">degree_dim</span><span class="o">=</span><span class="s1">&#39;degree&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sst_year</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">poly1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:                           (degree: 2)
Coordinates:
  * degree                            (degree) int64 1 0
Data variables:
    temperature_polyfit_coefficients  (degree) float64 0.005066 -9.702
    temp2_polyfit_coefficients        (degree) float64 0.005066 -11.7
Attributes: (12/24)
    title:                      subset of Native Format Berkeley Earth Surfac...
    Conventions:                CF-1.0
    source_field:               https://climexp.knmi.nl/select.cgi?field=berk...
    cdi:                        Climate Data Interface version 2.0.5 (https:/...
    institution:                KNMI Climate Explorer and Berkeley Earth Surf...
    land_source_history:        05-Mar-2023 08:24:35
    ...                         ...
    geospatial_lon_resolution:  1.0
    time_coverage_start:        1850-01-15
    time_coverage_end:          2023-02-15
    climexp_url:                https://climexp.knmi.nl/select.cgi?berkeley_l...
    scripturl01:                http://climexp.knmi.nl/get_index.cgi?email=so...
    history:                     2024-04-07 19:36:25 ./bin/get_index Berkeley...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x161e018e0&gt;]
</pre></div>
</div>
<img alt="../_images/dd9e71f11cfb577497194e8ad7771cf4812b482b4ee6dd7a845dcdd8c0ea15bf.png" src="../_images/dd9e71f11cfb577497194e8ad7771cf4812b482b4ee6dd7a845dcdd8c0ea15bf.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="filtering-and-spectra">
<h1>Filtering and spectra<a class="headerlink" href="#filtering-and-spectra" title="Permalink to this heading">#</a></h1>
<p>In the above section, you’ve done some quick and easy filtering by making annual averages.  Now we’ll try something a little more complicated using tide gauge data.</p>
<p>Pick a tide gauge from the east coast of the USA: <a class="reference external" href="https://www.bodc.ac.uk/data/hosted_data_systems/sea_level/international/north_atlantic/#Duck">https://www.bodc.ac.uk/data/hosted_data_systems/sea_level/international/north_atlantic/#Duck</a> and download the data in <code class="docutils literal notranslate"><span class="pre">*.nc</span></code> format.</p>
<p>Put the file in your <code class="docutils literal notranslate"><span class="pre">data/</span></code> directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sg</span>  <span class="c1">#Package for signal analysis</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">si</span> <span class="c1">#Another package for signal analysis</span>
<span class="c1">#from scipy.interpolate import interp1d  #for converting cell to grid-centered coordinates</span>
<span class="c1">#from scipy import stats    #Used for 2D binned statistics</span>
<span class="c1">#from mpl_toolkits.axes_grid1 import make_axes_locatable #For plotting interior colobars</span>
<span class="c1">#import cartopy.crs as ccrs</span>

<span class="kn">from</span> <span class="nn">multitaper</span> <span class="kn">import</span> <span class="n">MTSpec</span>  <span class="c1">#using German Prieto&#39;s multitaper package, https://github.com/gaprieto/multitaper</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">fft</span> <span class="k">as</span> <span class="n">spfft</span>
<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span> 
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">digamma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">6.5</span><span class="p">)</span> <span class="c1">#set default figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;serif&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">scipy.ndimage</span> <span class="k">as</span> <span class="nn">si</span> <span class="c1">#Another package for signal analysis</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">#from scipy.interpolate import interp1d  #for converting cell to grid-centered coordinates</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1">#from scipy import stats    #Used for 2D binned statistics</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1">#from mpl_toolkits.axes_grid1 import make_axes_locatable #For plotting interior colobars</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1">#import cartopy.crs as ccrs</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="kn">from</span> <span class="nn">multitaper</span> <span class="kn">import</span> <span class="n">MTSpec</span>  <span class="c1">#using German Prieto&#39;s multitaper package, https://github.com/gaprieto/multitaper</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">fft</span> <span class="k">as</span> <span class="n">spfft</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span> 

<span class="ne">ModuleNotFoundError</span>: No module named &#39;multitaper&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;../data/&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;w9006.nc&#39;</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">file_path</span> <span class="o">+</span> <span class="n">filename</span>
<span class="n">td</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">td</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">td_squeeze</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">td_squeeze</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">td_squeeze</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">td_squeeze</span><span class="o">.</span><span class="n">sea_level_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="select-a-one-year-time-period">
<h1>Select a one year time period<a class="headerlink" href="#select-a-one-year-time-period" title="Permalink to this heading">#</a></h1>
<p>Pick a year that looks filled in.  I.e., straight lines between big blocks of color are probably because there’s not data.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.xarray.dev/en/stable/user-guide/indexing.html">https://docs.xarray.dev/en/stable/user-guide/indexing.html</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">td_1995</span> <span class="o">=</span> <span class="n">td_squeeze</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;1995-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;1995-02-01&quot;</span><span class="p">))]</span>
<span class="n">td_1995</span> <span class="o">=</span> <span class="n">td_1995</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s2">&quot;woce_date&quot;</span><span class="p">,</span><span class="s2">&quot;woce_time&quot;</span><span class="p">,</span><span class="s2">&quot;sea_level_quality_flag_1&quot;</span><span class="p">])</span>
             
<span class="nb">print</span><span class="p">(</span><span class="n">td_1995</span><span class="p">)</span>
      
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">td_1995</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filt48</span> <span class="o">=</span> <span class="n">td_1995</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">td_1995</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">td_1995</span><span class="o">.</span><span class="n">sea_level_1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filt48</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">filt48</span><span class="o">.</span><span class="n">sea_level_1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filt48</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">filt48</span><span class="o">.</span><span class="n">sea_level_1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Has this removed the diurnal cycle?</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">td_1995</span><span class="o">.</span><span class="n">sea_level_1</span><span class="o">.</span><span class="n">values</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">cv</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c1">#sampling interval in days</span>
<span class="n">f</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">periodogram</span><span class="p">(</span><span class="n">cv</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv</span><span class="p">),</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span> <span class="c1">#fs = sampling frequency (cyclic)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1">#convert cyclic frequency to radian frequency</span>
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-root-py"
        },
        kernelOptions: {
            name: "conda-root-py",
            path: "./exercise"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-root-py'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Exercise 2  Time series</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-notebook-load-the-data">Create a notebook &amp; load the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-some-data">Download some data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-data">Load the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#errors-with-time-format">Errors with time format</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fig-1-plot-the-time-series">Fig 1. Plot the time series</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#errors">Errors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fixing-dimensionality">Fixing dimensionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#re-try-your-plotting">Re-try your plotting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#explore-the-data">Explore the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fig-2-plot-an-annual-cycle">Fig 2. Plot an annual cycle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-a-trend-updating-fig-1">Fitting a trend - updating Fig. 1</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-and-spectra">Filtering and spectra</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-a-one-year-time-period">Select a one year time period</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Eleanor Frajka-Williams
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>